计算机网络
===
`重点是ip、tcp、http`
网络层（IP）
--
传输层（TCP/UDP）
---
 1、描述TCP头部？

* 序号（32bit）：传输方向上字节流的字节编号。初始时序号会被设置一个随机的初始值（ISN），之后每次发送数据时，序号值 = ISN + 数据在整个字节流中的偏移。假设A -> B且ISN = 1024，第一段数据512字节已经到B，则第二段数据发送时序号为1024 + 512。用于解决网络包乱序问题。

* 确认号（32bit）：接收方对发送方TCP报文段的响应，其值是收到的序号值 + 1；第一次收到1024，确认号为1025。

* 首部长（4bit）：标识首部长度0~15，一个长度代表4字节，最大为15，即60字节。

* 标志位（6bit）：

    URG：标志紧急指针是否有效。

    ACK：标志确认号是否有效（确认报文段）。用于解决丢包问题。

    PSH：提示接收端立即从缓冲读走数据。

    RST：表示要求对方重新建立连接（复位报文段）。

    SYN：表示请求建立一个连接（连接报文段）。

    FIN：表示关闭连接（断开报文段）。

* 窗口（16bit）：接收窗口。用于告知对方（发送方）本方的缓冲还能接收多少字节数据。用于解决流控。

* 校验和（16bit）：接收端用CRC检验整个报文段有无损坏。

 2、三次握手和四次挥手过程？
![示意图](https://github.com/Planck-a/image-folder/blob/master/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/clipboard.png)
三次握手：客户端发起连接请求，SYN=1表示连接请求，随机的序列号SEQ_NUM=s；服务器收到后向客户端回复，发送确认包ACK=1,ACK_NUM=S+1,随机的序列号SEQ_NUM=q；客户端第三次回复ACK=1，ACK_NUM=q+1；
四次挥手：客户机发含FIN位，SEQ = Q的包到服务器。（客 -> FIN_WAIT_1）第二次：服务器发送含ACK且ACK_NUM = Q + 1的包到服务器，此处有等待。（服 -> CLOSE_WAIT，客 -> FIN_WAIT_2）；第三次：服务器发送含FIN且SEQ_NUM = R的包到客户机。（服 -> LAST_ACK，客 -> TIME_WAIT）此处有等待；第四次：客户机发送最后一个含有ACK位且ACK_NUM = R + 1的包到客户机。（服 -> CLOSED）

3、主动结束连接的一方为什么要等待2MSL？
A<-------B(B发FIN到A，第三次握手)
A------->B（A发ack到B，第四次握手）
为了防止第四次挥手没有正常达到对方，假如ACK没有到达B，B会为FIN这个消息超时重传,那如果A等待时间足够,又收到FIN消息,说明ACK没有到达B，于是再发送ACK，知道在足够的时间内没有收到FIN，说明ACK成功到达。
